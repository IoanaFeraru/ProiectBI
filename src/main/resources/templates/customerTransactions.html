<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Customer Transactions</title>

    <!-- External Styles & Scripts -->
    <link rel="stylesheet" type="text/css" th:href="@{/style.css}">
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">

    <!-- External Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>

</head>
<body>
<h1>Customer Transactions</h1>

<!-- Section: Top Loyal Customers -->
<h2>Top Loyal Customers</h2>
<form id="topCustomersForm">
    <label for="topX">Number of Top Loyal Customers:</label>
    <input type="range" id="topX" name="topX" min="10" max="100" value="10" step="1">
    <span id="topXValue">10</span>
    <br>

    <div id="loyaltyCriteria">
        <label>Total Spent
            <input type="radio" name="loyaltyCriteria" value="total_spent" onchange="fetchTopLoyalCustomers()">
        </label><br>
        <label>Purchase Frequency
            <input type="radio" name="loyaltyCriteria" value="purchase_frequency" onchange="fetchTopLoyalCustomers()">
        </label><br>
        <label>Combined
            <input type="radio" name="loyaltyCriteria" value="combined" checked onchange="fetchTopLoyalCustomers()">
        </label><br>
    </div>

</form>
<canvas id="loyaltyChart" width="150" height="60"></canvas>

<!-- Section: All Customers -->
<h2>All Customers</h2>
<div id="customersTableContainer">
    <label for="delayThreshold">Set Payment Delay Threshold (days):</label>
    <input type="number" id="delayThreshold" value="15" min="0">

    <table id="customersTable">
        <thead>
        <tr>
            <th onclick="sortTable(0)">Name <span class="sort-arrow asc selected" id="arrow-0"></span></th>
            <th>
                <select id="ageGroupFilter" onchange="filterTable()" style="width: 100%; border: none; background-color: transparent;">
                    <option value="">Age Group</option>
                    <option value="under 18">under 18</option>
                    <option value="18-25">18-25</option>
                    <option value="25-45">25-45</option>
                    <option value="45-60">45-60</option>
                    <option value="60 and above">60 and above</option>
                </select>
            </th>
            <th>
                <select id="genderFilter" onchange="filterTable()" style="width: 100%; border: none; background-color: transparent;">
                    <option value="">Gender</option>
                    <option value="Male">Male</option>
                    <option value="Female">Female</option>
                    <option value="Other">Other</option>
                </select>
            </th>
            <th onclick="sortTable(3)">Purchase Frequency <span class="sort-arrow" id="arrow-3"></span></th>
            <th onclick="sortTable(4)">Total Spent ($) <span class="sort-arrow" id="arrow-4"></span></th>
            <th onclick="sortTable(5)">Average Payment Delay (days) <span class="sort-arrow" id="arrow-5"></span></th>
        </tr>
        </thead>
        <tbody>
        <!-- Data will be populated here dynamically -->
        </tbody>
    </table>
</div>
<div id="loading" style="display: none;">
    <p>Loading, please wait...</p>
</div>

<!-- Section: Correlate Discounts -->
<h2>Correlate Discounts</h2>
<canvas id="discountsByGenderChart" width="400" height="400"></canvas>
<canvas id="discountsByAgeGroupChart" width="400" height="400"></canvas>
<canvas id="discountsByTypeChart" width="400" height="400"></canvas>

<!-- Section: Estimate Cash Flow -->
<h2>Estimate Cash Flow</h2>
<div>
    <input type="range" id="monthSlider" min="0" max="36" value="6" />
    <span id="selectedMonths">6</span> months ahead
</div>
<canvas id="cashFlowChart" width="400" height="200"></canvas>

<script th:src="@{/script.js}"></script>
</body>
</html>
